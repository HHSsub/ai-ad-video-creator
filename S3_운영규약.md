# Nexxii S3 미디어 저장소 운영 규약 (Operation Contract)

> **문서 목적**: S3 저장소 사용에 대한 명확한 경계와 책임을 정의  
> **최초 작성**: 2025-12-24  
> **적용 범위**: `nexxii-media-storage` S3 버킷 전체

---

## 1. 허용 데이터 (Allowed Data)

### 1.1 프로젝트 미디어 파일 (`projects/`)

**허용**:
- ✅ 사용자가 생성한 광고 이미지 (JPEG, PNG, WebP)
- ✅ 사용자가 생성한 광고 비디오 (MP4, WebM)
- ✅ 프로젝트 메타데이터 (JSON)
- ✅ Freepik/SEEDREAM API로 생성한 이미지 (라이선스 준수 시)
- ✅ 사용자가 업로드한 브랜드 로고/제품 이미지 (저작권 보유 시)

**조건**:
- 파일 크기: 이미지 최대 10MB, 비디오 최대 100MB
- 파일 형식: 웹 표준 포맷만 (JPEG, PNG, WebP, MP4, WebM)
- 명명 규칙: `projects/{projectId}/images/concept_{conceptId}_scene_{sceneNumber}.jpg`

---

### 1.2 임시 파일 (`temp/`)

**허용**:
- ✅ 이미지 생성 중 임시 저장 파일 (24시간 이내 삭제 예정)
- ✅ 비디오 변환 중 임시 파일
- ✅ 세션 복구용 임시 데이터

**조건**:
- 보관 기간: 최대 24시간 (자동 삭제)
- 용도: 프로세스 중단 시 복구용으로만 사용
- 최종 결과물은 반드시 `projects/`로 이동

---

### 1.3 추천 캐시 (`nexad-recommendations/`)

**허용**:
- ✅ Nexad 광고 추천 결과 (JSON)
- ✅ YouTube 비디오 메타데이터 (썸네일 URL, 제목, 설명)

**조건**:
- 개인정보 미포함 (공개 YouTube 데이터만)
- 캐시 유효기간: 24시간 (HTTP Cache-Control 헤더)

---

## 2. 금지 데이터 (Prohibited Data)

### 2.1 절대 저장 금지

**❌ 개인정보**:
- 사용자 비밀번호 (해시 포함)
- 이메일 주소
- 전화번호
- 주민등록번호, 여권번호 등 식별 정보
- 결제 정보 (카드번호, 계좌번호)

**❌ 저작권 침해 콘텐츠**:
- 무단 복제된 이미지/비디오
- 타인의 저작물 (허가 없이)
- 불법 다운로드 파일

**❌ 유해 콘텐츠**:
- 음란물
- 폭력적 이미지
- 혐오 표현 포함 콘텐츠
- 불법 광고 (도박, 마약 등)

**❌ 시스템 파일**:
- 실행 파일 (.exe, .sh, .bat)
- 스크립트 파일 (.js, .py, .php - 코드 실행 목적)
- 압축 파일 (.zip, .tar.gz - 내용 불명확)

---

### 2.2 저장 금지 이유

| 데이터 유형 | 금지 이유 | 위반 시 조치 |
|------------|----------|------------|
| 개인정보 | GDPR, 개인정보보호법 위반 | 즉시 삭제 + 사용자 계정 정지 |
| 저작권 침해 | 법적 책임 | 즉시 삭제 + 프로젝트 삭제 |
| 유해 콘텐츠 | 서비스 약관 위반 | 즉시 삭제 + 계정 영구 정지 |
| 실행 파일 | 보안 위협 | 업로드 차단 (사전 검증) |

---

## 3. 임시(temp) vs 영구(projects) 책임 차이

### 3.1 임시 저장소 (`temp/`)

**책임 범위**:
- ✅ 시스템이 자동 삭제 (24시간 후)
- ✅ 사용자 복구 요청 불가 (명시적 안내 필요)
- ✅ 백업 대상 아님

**사용 원칙**:
- 프로세스 진행 중에만 사용
- 최종 결과물은 반드시 `projects/`로 이동
- 사용자에게 "임시 저장" 명시적 고지

**예외 처리**:
- 24시간 내 프로세스 완료 못 하면 → 사용자에게 재시작 요청
- 임시 파일 손실 → 시스템 책임 없음 (약관 명시)

---

### 3.2 영구 저장소 (`projects/`)

**책임 범위**:
- ✅ 사용자가 명시적으로 삭제할 때까지 보관
- ✅ S3 내구성 99.999999999% 보장
- ✅ 백업 대상 (선택사항)

**사용 원칙**:
- 프로젝트 완료 후 저장
- 사용자 소유권 명확 (프로젝트 ID 기반)
- 삭제는 사용자 요청 시에만

**보관 기간**:
- 기본: 무기한 (사용자 삭제 전까지)
- 예외: 계정 탈퇴 시 30일 후 자동 삭제 (유예 기간)

---

## 4. Freepik/외부 API 저작권 책임 경계

### 4.1 Freepik/SEEDREAM API 이미지

**라이선스 조건**:
- Freepik API로 생성한 이미지는 **사용자 소유**
- 단, Freepik 약관 준수 필요:
  - ✅ 상업적 사용 가능 (유료 플랜)
  - ❌ 재판매 금지
  - ❌ 대량 다운로드 금지

**책임 경계**:
- **Nexxii 책임**: API 호출 및 S3 저장
- **사용자 책임**: 생성된 이미지의 최종 사용 (광고 게시 등)
- **Freepik 책임**: 이미지 생성 품질 및 저작권 보증

**저장 정책**:
- ✅ Freepik API 응답의 임시 URL → S3 영구 URL로 변환
- ✅ 원본 메타데이터 보존 (생성 시각, API 버전 등)
- ❌ Freepik 워터마크 제거 금지

---

### 4.2 사용자 업로드 이미지

**책임 경계**:
- **사용자 책임**: 업로드한 이미지의 저작권 보유 확인
- **Nexxii 책임**: 명백한 저작권 침해 신고 시 삭제

**검증 절차**:
- 업로드 시 약관 동의 필수: "저작권을 보유하거나 사용 권한이 있는 이미지만 업로드"
- 신고 접수 시 24시간 내 검토 → 삭제 여부 결정

---

### 4.3 Nexad 추천 YouTube 데이터

**책임 경계**:
- **YouTube 책임**: 비디오 콘텐츠 저작권
- **Nexxii 책임**: 공개 메타데이터만 캐싱 (썸네일 URL, 제목)
- **사용자 책임**: 추천 영상 참고용으로만 사용 (복제 금지)

**저장 정책**:
- ✅ YouTube 비디오 ID, 제목, 썸네일 URL만 저장
- ❌ 비디오 파일 자체는 저장 금지
- ❌ 비공개 영상 정보 저장 금지

---

## 5. 사용자 삭제 요청 시 처리 원칙

### 5.1 프로젝트 삭제

**즉시 삭제**:
- 사용자가 프로젝트 삭제 버튼 클릭 시
- S3에서 해당 프로젝트 폴더 전체 삭제
- CloudFront 캐시 무효화 (선택사항)

**삭제 범위**:
```
projects/{projectId}/
├── images/       ← 전체 삭제
├── videos/       ← 전체 삭제
└── metadata.json ← 삭제
```

**복구 불가**:
- 삭제 전 경고 메시지: "삭제된 프로젝트는 복구할 수 없습니다"
- 삭제 후 30일 유예 기간 없음 (즉시 영구 삭제)

---

### 5.2 계정 탈퇴

**유예 기간**: 30일

**처리 절차**:
1. 탈퇴 요청 시 → 계정 비활성화
2. 30일 동안 데이터 보관 (복구 가능)
3. 30일 후 → S3 전체 삭제

**삭제 범위**:
```
projects/{userId}_*/  ← 해당 사용자의 모든 프로젝트
```

**예외**:
- 법적 보관 의무 데이터 (세금 계산서 등): 5년 보관 후 삭제

---

### 5.3 GDPR "잊혀질 권리" 요청

**즉시 삭제** (유예 기간 없음):
- 사용자가 GDPR 요청 시 24시간 내 처리
- S3 데이터 + 데이터베이스 + 로그 전체 삭제
- 삭제 완료 확인서 발급

---

## 6. 비용 폭증 방지 규칙

### 6.1 용량 제한

**프로젝트당 제한**:
- 이미지: 최대 50개 × 10MB = 500MB
- 비디오: 최대 10개 × 100MB = 1GB
- **프로젝트당 총 용량: 1.5GB**

**사용자당 제한**:
- 무료 플랜: 총 5GB
- 유료 플랜: 총 50GB
- 초과 시 → 추가 요금 또는 업로드 차단

---

### 6.2 파일 개수 제한

**프로젝트당**:
- 이미지: 최대 50개
- 비디오: 최대 10개

**사용자당**:
- 프로젝트: 최대 100개 (무료), 1000개 (유료)

**초과 시**:
- 새 프로젝트 생성 차단
- 기존 프로젝트 삭제 후 생성 가능

---

### 6.3 파일 크기 제한

| 파일 유형 | 최대 크기 | 초과 시 조치 |
|----------|----------|------------|
| 이미지 (JPEG, PNG) | 10MB | 업로드 차단 + 압축 권장 |
| 비디오 (MP4) | 100MB | 업로드 차단 + 해상도 낮추기 권장 |
| JSON 메타데이터 | 1MB | 업로드 차단 |

**검증 시점**:
- 클라이언트 업로드 전 (JavaScript)
- 서버 업로드 시 (백엔드)
- S3 업로드 전 (최종 검증)

---

### 6.4 API 호출 제한 (Rate Limiting)

**Freepik API**:
- 사용자당: 100회/일 (무료), 1000회/일 (유료)
- 프로젝트당: 최대 50회 (이미지 50개)

**S3 업로드**:
- 사용자당: 500회/일 (무료), 5000회/일 (유료)
- 동시 업로드: 최대 10개

**초과 시**:
- 429 Too Many Requests 응답
- 24시간 후 자동 리셋

---

### 6.5 비용 모니터링

**알림 기준**:
- S3 저장 용량: 100GB 초과 시 알림
- S3 전송량: 1TB/월 초과 시 알림
- CloudFront 전송량: 10TB/월 초과 시 알림

**긴급 조치**:
- 비정상 트래픽 감지 시 → 일시 중단
- 예: 1시간에 10,000회 업로드 → DDoS 의심

---

## 7. CloudFront 캐시 무효화 (Invalidation) 기준

### 7.1 무효화 금지 (Cost Saving)

**금지 상황**:
- ❌ 사용자가 이미지 재생성할 때마다
- ❌ 프로젝트 수정할 때마다
- ❌ 실시간 반영 목적

**이유**:
- CloudFront Invalidation 비용: 1,000개 경로까지 무료, 이후 $0.005/경로
- 대량 무효화 시 비용 폭증 위험

**대안**:
- 파일명에 버전 추가: `image_v2.jpg` (캐시 우회)
- Query String 사용: `image.jpg?v=2` (캐시 우회)

---

### 7.2 무효화 허용 (필수 상황)

**허용 상황**:
- ✅ 저작권 침해 콘텐츠 삭제 시 (긴급)
- ✅ 유해 콘텐츠 삭제 시 (긴급)
- ✅ 시스템 업데이트 (월 1회 이하)

**무효화 범위**:
- 특정 파일: `/nexxii-storage/projects/{projectId}/images/scene_1.jpg`
- 프로젝트 전체: `/nexxii-storage/projects/{projectId}/*`
- **전체 무효화 금지**: `/nexxii-storage/*` (비용 폭증)

---

### 7.3 무효화 승인 프로세스

**일반 무효화**:
1. 개발자 요청 → 팀장 승인 → 실행
2. 사유 기록 (Slack, Jira 등)

**긴급 무효화** (저작권/유해 콘텐츠):
1. 신고 접수 → 즉시 실행 (승인 불필요)
2. 사후 보고

**무효화 로그**:
- 실행 시각, 경로, 사유, 실행자 기록
- 월별 무효화 횟수 모니터링 (비용 추적)

---

## 8. 위반 시 조치

### 8.1 경고 단계

**1차 위반**:
- 경고 메시지 발송
- 위반 콘텐츠 삭제
- 계정 정상 유지

**2차 위반**:
- 계정 7일 정지
- 위반 콘텐츠 삭제
- 재발 방지 서약서 제출

**3차 위반**:
- 계정 영구 정지
- 모든 데이터 삭제
- 재가입 금지

---

### 8.2 즉시 정지 (Zero Tolerance)

**해당 사항**:
- 개인정보 대량 유출
- 저작권 침해 (법적 통지 접수 시)
- 유해 콘텐츠 (음란물, 폭력)
- 시스템 공격 (DDoS, 해킹 시도)

**조치**:
- 즉시 계정 정지
- 모든 데이터 삭제
- 법적 조치 (필요 시)

---

## 9. 책임 면책 (Disclaimer)

### 9.1 Nexxii 면책 사항

**면책 범위**:
- 사용자가 업로드한 콘텐츠의 저작권
- 사용자가 생성한 광고의 법적 책임
- Freepik API 장애로 인한 이미지 생성 실패
- S3/CloudFront AWS 장애 (SLA 99.9% 이하)

**책임 범위**:
- S3 데이터 보관 (AWS SLA 준수)
- 명백한 저작권 침해 신고 시 삭제
- 개인정보 보호 (GDPR, 개인정보보호법 준수)

---

### 9.2 사용자 책임

**사용자 의무**:
- 업로드 콘텐츠의 저작권 확인
- 생성된 광고의 법적 검토
- 유해 콘텐츠 업로드 금지
- 서비스 약관 준수

**위반 시**:
- 법적 책임은 사용자 부담
- Nexxii는 협조 의무만 (데이터 제공 등)

---

## 10. 문서 개정 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2025-12-24 | 최초 작성 | AI Assistant |

---

**문서 승인**: (서명 필요)  
**다음 검토일**: 2026-06-24 (6개월 후)
